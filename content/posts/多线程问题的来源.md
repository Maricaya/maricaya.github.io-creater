---
title: "多线程问题的来源"
date: 2020-01-03T10:07:15+08:00
draft: true
---

<!-- 
  为什么需要多线程？
  多线程带来了什么问题，如何避免？
  线程的属性、状态、生命周期详解
  什么是ThreadLocal？
  为什么需要线程池？
  线程池的构造函数中的参数都是什么含义？
-->

<!-- 多线程赋予了计算机同时完成很多件事情的能力，这等价于将它的计算能力提高了许多倍。 -->
多线程问题是Java面试中常考问题，一定要熟练掌握它。

# 问题一：为什么需要多线程？
现代CPU执行速度是非常快的，但是Java默认只有一个线程，Java的执行模型是同步、阻塞的。
当你在进行一个非常耗时的操作时，当前线程执行流会停在这里，等着方法执行完成。
而在实际生产中，如果用户同时请求一个命令，后来的用户就需要等前面的执行完后，才得到结果。
那么，我们能不能多请几个人来处理这些命令，让这些用户可以同时得到结果？
这就是使用多线程的原因。
最后，还有一点，现代的CPU都是多核的，理论上具有天然的并发能力。

1. Java的执行模型是同步、阻塞的
什么是同步、阻塞？来看这段代码
```java
public static void main(String[] args) throws InterruptedException {
  a();
  System.out.println(1);
}
private static void a() throws InterruptedException {
  Thread.sleep(100);
  b();
}

private static void b() throws InterruptedException {
  Thread.sleep(1000);
}
```
1100s后才会打印出1。
当你在进行一个非常耗时的操作时，当前线程执行流会停在这里，等着方法执行完成。
这个过程称为**阻塞（block）**。

2. CPU：你们都慢死了！
对于一个现代3GHz的CPU来说，一个时钟周期是0.3ns。CPU做事情是非常快的，但是内存、磁盘、网络IO操作是很慢的。比如：内存典型寻址时间是10us左右。
CPU需要频繁地停下来等待其他操作，CPU完全可以在等待时，做一些其他事情。

3. 现代的CPU都是多核的。
多核CPU比单核可以做的事情更多，而且不会显著增加发热量。
而多核CPU理论上具有天然的并发能力，可以同时做很多事情。

4. Java默认只有一个线程
在实际生产中，如果用户同时请求一个命令，需要同时处理这些请求，但是Java默认只有一个线程，只能同时处理一个请求。
那么，我们能不能多雇几个人同时处理这些请求。即，使用多线程。